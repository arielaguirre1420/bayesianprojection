call pr_wrk.drop_table ('ltv_retentions');
create multiset volatile table ltv_retentions, no log
as(
select
	calendar_dt as install_dt,
	sum(Day_000_Ret_Qty) as Day_000_Ret_Qty,
	sum(Day_001_Ret_Qty) as Day_001_Ret_Qty,
	sum(Day_002_Ret_Qty) as Day_002_Ret_Qty,
	sum(Day_003_Ret_Qty) as Day_003_Ret_Qty,
	sum(Day_004_Ret_Qty) as Day_004_Ret_Qty,
	sum(Day_005_Ret_Qty) as Day_005_Ret_Qty,
	sum(Day_006_Ret_Qty) as Day_006_Ret_Qty,
	sum(Day_007_Ret_Qty) as Day_007_Ret_Qty,
	sum(Day_008_Ret_Qty) as Day_008_Ret_Qty,
	sum(Day_009_Ret_Qty) as Day_009_Ret_Qty,
	sum(Day_010_Ret_Qty) as Day_010_Ret_Qty,
	sum(Day_011_Ret_Qty) as Day_011_Ret_Qty,
	sum(Day_012_Ret_Qty) as Day_012_Ret_Qty,
	sum(Day_013_Ret_Qty) as Day_013_Ret_Qty,
	sum(Day_014_Ret_Qty) as Day_014_Ret_Qty,
	sum(Day_015_Ret_Qty) as Day_015_Ret_Qty,
	sum(Day_016_Ret_Qty) as Day_016_Ret_Qty,
	sum(Day_017_Ret_Qty) as Day_017_Ret_Qty,
	sum(Day_018_Ret_Qty) as Day_018_Ret_Qty,
	sum(Day_019_Ret_Qty) as Day_019_Ret_Qty,
	sum(Day_020_Ret_Qty) as Day_020_Ret_Qty,
	sum(Day_021_Ret_Qty) as Day_021_Ret_Qty,
	sum(Day_022_Ret_Qty) as Day_022_Ret_Qty,
	sum(Day_023_Ret_Qty) as Day_023_Ret_Qty,
	sum(Day_024_Ret_Qty) as Day_024_Ret_Qty,
	sum(Day_025_Ret_Qty) as Day_025_Ret_Qty,
	sum(Day_026_Ret_Qty) as Day_026_Ret_Qty,
	sum(Day_027_Ret_Qty) as Day_027_Ret_Qty,
	sum(Day_028_Ret_Qty) as Day_028_Ret_Qty,
	sum(Day_029_Ret_Qty) as Day_029_Ret_Qty,
	 sum(Day_030_Ret_Qty) as Day_030_Ret_Qty,
	 sum(Day_031_Ret_Qty) as Day_031_Ret_Qty,
	 sum(Day_032_Ret_Qty) as Day_032_Ret_Qty,
	 sum(Day_033_Ret_Qty) as Day_033_Ret_Qty,
	 sum(Day_034_Ret_Qty) as Day_034_Ret_Qty,
	 sum(Day_035_Ret_Qty) as Day_035_Ret_Qty,
	 sum(Day_036_Ret_Qty) as Day_036_Ret_Qty,
	 sum(Day_037_Ret_Qty) as Day_037_Ret_Qty,
	 sum(Day_038_Ret_Qty) as Day_038_Ret_Qty,
	 sum(Day_039_Ret_Qty) as Day_039_Ret_Qty,
	 sum(Day_040_Ret_Qty) as Day_040_Ret_Qty,
	 sum(Day_041_Ret_Qty) as Day_041_Ret_Qty,
	 sum(Day_042_Ret_Qty) as Day_042_Ret_Qty,
	 sum(Day_043_Ret_Qty) as Day_043_Ret_Qty,
	 sum(Day_044_Ret_Qty) as Day_044_Ret_Qty,
	 sum(Day_045_Ret_Qty) as Day_045_Ret_Qty,
	 sum(Day_046_Ret_Qty) as Day_046_Ret_Qty,
	 sum(Day_047_Ret_Qty) as Day_047_Ret_Qty,
	 sum(Day_048_Ret_Qty) as Day_048_Ret_Qty,
	 sum(Day_049_Ret_Qty) as Day_049_Ret_Qty,
	 sum(Day_050_Ret_Qty) as Day_050_Ret_Qty,
	 sum(Day_051_Ret_Qty) as Day_051_Ret_Qty,
	 sum(Day_052_Ret_Qty) as Day_052_Ret_Qty,
	 sum(Day_053_Ret_Qty) as Day_053_Ret_Qty,
	 sum(Day_054_Ret_Qty) as Day_054_Ret_Qty,
	 sum(Day_055_Ret_Qty) as Day_055_Ret_Qty,
	 sum(Day_056_Ret_Qty) as Day_056_Ret_Qty,
	 sum(Day_057_Ret_Qty) as Day_057_Ret_Qty,
	 sum(Day_058_Ret_Qty) as Day_058_Ret_Qty,
	 sum(Day_059_Ret_Qty) as Day_059_Ret_Qty,
	 sum(Day_060_Ret_Qty) as Day_060_Ret_Qty,
	 sum(Day_061_Ret_Qty) as Day_061_Ret_Qty,
	 sum(Day_062_Ret_Qty) as Day_062_Ret_Qty,
	 sum(Day_063_Ret_Qty) as Day_063_Ret_Qty,
	 sum(Day_064_Ret_Qty) as Day_064_Ret_Qty,
	 sum(Day_065_Ret_Qty) as Day_065_Ret_Qty,
	 sum(Day_066_Ret_Qty) as Day_066_Ret_Qty,
	 sum(Day_067_Ret_Qty) as Day_067_Ret_Qty,
	 sum(Day_068_Ret_Qty) as Day_068_Ret_Qty,
	 sum(Day_069_Ret_Qty) as Day_069_Ret_Qty,
	 sum(Day_070_Ret_Qty) as Day_070_Ret_Qty,
	 sum(Day_071_Ret_Qty) as Day_071_Ret_Qty,
	 sum(Day_072_Ret_Qty) as Day_072_Ret_Qty,
	 sum(Day_073_Ret_Qty) as Day_073_Ret_Qty,
	 sum(Day_074_Ret_Qty) as Day_074_Ret_Qty,
	 sum(Day_075_Ret_Qty) as Day_075_Ret_Qty,
	 sum(Day_076_Ret_Qty) as Day_076_Ret_Qty,
	 sum(Day_077_Ret_Qty) as Day_077_Ret_Qty,
	 sum(Day_078_Ret_Qty) as Day_078_Ret_Qty,
	 sum(Day_079_Ret_Qty) as Day_079_Ret_Qty,
	 sum(Day_080_Ret_Qty) as Day_080_Ret_Qty,
	 sum(Day_081_Ret_Qty) as Day_081_Ret_Qty,
	 sum(Day_082_Ret_Qty) as Day_082_Ret_Qty,
	 sum(Day_083_Ret_Qty) as Day_083_Ret_Qty,
	 sum(Day_084_Ret_Qty) as Day_084_Ret_Qty,
	 sum(Day_085_Ret_Qty) as Day_085_Ret_Qty,
	 sum(Day_086_Ret_Qty) as Day_086_Ret_Qty,
	 sum(Day_087_Ret_Qty) as Day_087_Ret_Qty,
	 sum(Day_088_Ret_Qty) as Day_088_Ret_Qty,
	 sum(Day_089_Ret_Qty) as Day_089_Ret_Qty,
	 sum(Day_090_Ret_Qty) as Day_090_Ret_Qty,
	 sum(Day_091_Ret_Qty) as Day_091_Ret_Qty,
	 sum(Day_092_Ret_Qty) as Day_092_Ret_Qty,
	 sum(Day_093_Ret_Qty) as Day_093_Ret_Qty,
	 sum(Day_094_Ret_Qty) as Day_094_Ret_Qty,
	 sum(Day_095_Ret_Qty) as Day_095_Ret_Qty,
	 sum(Day_096_Ret_Qty) as Day_096_Ret_Qty,
	 sum(Day_097_Ret_Qty) as Day_097_Ret_Qty,
	 sum(Day_098_Ret_Qty) as Day_098_Ret_Qty,
	 sum(Day_099_Ret_Qty) as Day_099_Ret_Qty,
	 sum(Day_100_Ret_Qty) as Day_100_Ret_Qty,
	 sum(Day_101_Ret_Qty) as Day_101_Ret_Qty,
	 sum(Day_102_Ret_Qty) as Day_102_Ret_Qty,
	 sum(Day_103_Ret_Qty) as Day_103_Ret_Qty,
	 sum(Day_104_Ret_Qty) as Day_104_Ret_Qty,
	 sum(Day_105_Ret_Qty) as Day_105_Ret_Qty,
	 sum(Day_106_Ret_Qty) as Day_106_Ret_Qty,
	 sum(Day_107_Ret_Qty) as Day_107_Ret_Qty,
	 sum(Day_108_Ret_Qty) as Day_108_Ret_Qty,
	 sum(Day_109_Ret_Qty) as Day_109_Ret_Qty,
	 sum(Day_110_Ret_Qty) as Day_110_Ret_Qty,
	 sum(Day_111_Ret_Qty) as Day_111_Ret_Qty,
	 sum(Day_112_Ret_Qty) as Day_112_Ret_Qty,
	 sum(Day_113_Ret_Qty) as Day_113_Ret_Qty,
	 sum(Day_114_Ret_Qty) as Day_114_Ret_Qty,
	 sum(Day_115_Ret_Qty) as Day_115_Ret_Qty,
	 sum(Day_116_Ret_Qty) as Day_116_Ret_Qty,
	 sum(Day_117_Ret_Qty) as Day_117_Ret_Qty,
	 sum(Day_118_Ret_Qty) as Day_118_Ret_Qty,
	 sum(Day_119_Ret_Qty) as Day_119_Ret_Qty,
	 sum(Day_120_Ret_Qty) as Day_120_Ret_Qty,
	 sum(Day_121_Ret_Qty) as Day_121_Ret_Qty,
	 sum(Day_122_Ret_Qty) as Day_122_Ret_Qty,
	 sum(Day_123_Ret_Qty) as Day_123_Ret_Qty,
	 sum(Day_124_Ret_Qty) as Day_124_Ret_Qty,
	 sum(Day_125_Ret_Qty) as Day_125_Ret_Qty,
	 sum(Day_126_Ret_Qty) as Day_126_Ret_Qty,
	 sum(Day_127_Ret_Qty) as Day_127_Ret_Qty,
	 sum(Day_128_Ret_Qty) as Day_128_Ret_Qty,
	 sum(Day_129_Ret_Qty) as Day_129_Ret_Qty,
	 sum(Day_130_Ret_Qty) as Day_130_Ret_Qty,
	 sum(Day_131_Ret_Qty) as Day_131_Ret_Qty,
	 sum(Day_132_Ret_Qty) as Day_132_Ret_Qty,
	 sum(Day_133_Ret_Qty) as Day_133_Ret_Qty,
	 sum(Day_134_Ret_Qty) as Day_134_Ret_Qty,
	 sum(Day_135_Ret_Qty) as Day_135_Ret_Qty,
	 sum(Day_136_Ret_Qty) as Day_136_Ret_Qty,
	 sum(Day_137_Ret_Qty) as Day_137_Ret_Qty,
	 sum(Day_138_Ret_Qty) as Day_138_Ret_Qty,
	 sum(Day_139_Ret_Qty) as Day_139_Ret_Qty,
	 sum(Day_140_Ret_Qty) as Day_140_Ret_Qty,
	 sum(Day_141_Ret_Qty) as Day_141_Ret_Qty,
	 sum(Day_142_Ret_Qty) as Day_142_Ret_Qty,
	 sum(Day_143_Ret_Qty) as Day_143_Ret_Qty,
	 sum(Day_144_Ret_Qty) as Day_144_Ret_Qty,
	 sum(Day_145_Ret_Qty) as Day_145_Ret_Qty,
	 sum(Day_146_Ret_Qty) as Day_146_Ret_Qty,
	 sum(Day_147_Ret_Qty) as Day_147_Ret_Qty,
	 sum(Day_148_Ret_Qty) as Day_148_Ret_Qty,
	 sum(Day_149_Ret_Qty) as Day_149_Ret_Qty,
	 sum(Day_150_Ret_Qty) as Day_150_Ret_Qty,
	 sum(Day_151_Ret_Qty) as Day_151_Ret_Qty,
	 sum(Day_152_Ret_Qty) as Day_152_Ret_Qty,
	 sum(Day_153_Ret_Qty) as Day_153_Ret_Qty,
	 sum(Day_154_Ret_Qty) as Day_154_Ret_Qty,
	 sum(Day_155_Ret_Qty) as Day_155_Ret_Qty,
	 sum(Day_156_Ret_Qty) as Day_156_Ret_Qty,
	 sum(Day_157_Ret_Qty) as Day_157_Ret_Qty,
	 sum(Day_158_Ret_Qty) as Day_158_Ret_Qty,
	 sum(Day_159_Ret_Qty) as Day_159_Ret_Qty,
	 sum(Day_160_Ret_Qty) as Day_160_Ret_Qty,
	 sum(Day_161_Ret_Qty) as Day_161_Ret_Qty,
	 sum(Day_162_Ret_Qty) as Day_162_Ret_Qty,
	 sum(Day_163_Ret_Qty) as Day_163_Ret_Qty,
	 sum(Day_164_Ret_Qty) as Day_164_Ret_Qty,
	 sum(Day_165_Ret_Qty) as Day_165_Ret_Qty,
	 sum(Day_166_Ret_Qty) as Day_166_Ret_Qty,
	 sum(Day_167_Ret_Qty) as Day_167_Ret_Qty,
	 sum(Day_168_Ret_Qty) as Day_168_Ret_Qty,
	 sum(Day_169_Ret_Qty) as Day_169_Ret_Qty,
	 sum(Day_170_Ret_Qty) as Day_170_Ret_Qty,
	 sum(Day_171_Ret_Qty) as Day_171_Ret_Qty,
	 sum(Day_172_Ret_Qty) as Day_172_Ret_Qty,
	 sum(Day_173_Ret_Qty) as Day_173_Ret_Qty,
	 sum(Day_174_Ret_Qty) as Day_174_Ret_Qty,
	 sum(Day_175_Ret_Qty) as Day_175_Ret_Qty,
	 sum(Day_176_Ret_Qty) as Day_176_Ret_Qty,
	 sum(Day_177_Ret_Qty) as Day_177_Ret_Qty,
	 sum(Day_178_Ret_Qty) as Day_178_Ret_Qty,
	 sum(Day_179_Ret_Qty) as Day_179_Ret_Qty,
	 sum(Day_180_Ret_Qty) as Day_180_Ret_Qty
from
	pr_dim_vw.fact_application_retention
where
	application_cd = 2116 and
	--country_cd in (@country_list) and
	calendar_dt between date '2016-07-01' and date '2016-12-31'
group by 1
)with data
primary index (install_dt)
on commit preserve rows
;

call pr_wrk.drop_table ('ltv_revenues');
create multiset volatile table ltv_revenues, no log
as(
select
	install_dt,
	calendar_dt - install_dt as user_age,
	sum(iap_revenue_amt) as total_revenue_amt
from
	pr_dim_tb.fact_application_revenue_daily
where
	application_cd = 2116 and
	--country_cd in (@country_list) and
	install_dt between date '2016-07-01' and date '2016-12-31' and
	calendar_dt - install_dt <= 180
group by 1,2
) with data
primary index (install_dt)
on commit preserve rows;

select * from ltv_retentions;
select * from ltv_revenues;